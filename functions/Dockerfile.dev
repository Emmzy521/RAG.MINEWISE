# Development Dockerfile with build step included
# Use this for local testing or CI/CD pipelines that don't pre-build

FROM node:18-slim

WORKDIR /app

# Copy package files
COPY package.json .
COPY pnpm-lock.yaml .

# Install pnpm and dependencies (including dev dependencies for building)
RUN npm install pnpm -g && \
    pnpm install --frozen-lockfile

# Copy source code
COPY ./src/ /app/src/
COPY ./tsconfig.json /app/

# Build TypeScript
RUN pnpm run build

# Cloud Run automatically sets the PORT environment variable
ENV PORT 8080

# Specify the command to run the application
CMD [ "node", "dist/server.js" ]
